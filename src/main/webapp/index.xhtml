<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

<h:head>
    <title>Analisador de Frases</title>
    <link rel="icon" href="https://media.licdn.com/dms/image/v2/C4D0BAQHYABqb7Dvgjw/company-logo_200_200/company-logo_200_200/0/1630572893429/prover_sistema_logo?e=2147483647&amp;v=beta&amp;t=vf-rw5GiJwpp1olvo3zRq1bthKSLpqetNx7iiQVS8yw" type="image/x-icon"/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

    <style type="text/css">
        body {
            background-color: #f8f9fa;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 960px;
            margin: 20px auto;
        }

        .main-title {
            text-align: center;
            color: #495057;
            font-size: 2.5rem;
            font-weight: 300;
            margin-bottom: 30px;
        }

        .ui-button {
            margin-top: 10px;
        }

        .custom-badge {
            background-color: #17a2b8;
            color: white;
            padding: 5px 10px;
            border-radius: 16px;
            font-weight: bold;
            font-size: 0.9em;
            vertical-align: middle;
            display: inline-block;
        }
    </style>
</h:head>

<h:body>

    <p:ajaxStatus style="width:20px; height:20px; position:fixed; top:10px; right:10px;">
        <f:facet name="start">
            <i class="pi pi-spin pi-spinner" style="font-size: 2rem; color: #007bff;"></i>
        </f:facet>
        <f:facet name="complete">
            <h:outputText value="" />
        </f:facet>
    </p:ajaxStatus>

    <div class="container">

        <h1 class="main-title">Analisador de Frases</h1>

        <p:tabView id="mainTabView">

            <p:tab title="Analisador">

                <h:form id="formPrincipal">

                    <p:panel header="Ferramenta de Análise">
                        <p:messages id="messages" showDetail="true" closable="true">
                            <p:autoUpdate/>
                        </p:messages>

                        <h:panelGrid columns="1" style="width: 100%;">
                            <p:outputLabel for="fraseInput" value="Digite ou cole o texto a ser analisado:"/>
                            <p:inputTextarea id="fraseInput" value="#{analiseBean.frase}"
                                             rows="6" required="true"
                                             requiredMessage="O campo do texto não pode ser vazio."
                                             autoResize="true"
                                             style="width: 100%;" />

                            <p:commandButton value="Analisar Texto"
                                             action="#{analiseBean.analisarFrase()}"
                                             icon="pi pi-search"
                                             process="@form"
                                             update="painelResultados :mainTabView"
                                             oncomplete="if (args &amp;&amp; !args.validationFailed) PF('tabelaPalavras').clearFilters()"
                                             styleClass="ui-button-success" />
                        </h:panelGrid>
                    </p:panel>

                    <p:panel id="painelResultados" header="Resultados da Análise" style="margin-top: 30px;" rendered="#{analiseBean.submetido}">
                        <h:panelGrid columns="2" cellpadding="10">
                            <h:outputText value="Total de palavras distintas:" style="font-weight: bold;"/>
                            <h:outputText value="#{analiseBean.contagemPalavrasDistintas}" styleClass="custom-badge" />
                        </h:panelGrid>

                        <p:dataTable widgetVar="tabelaPalavras"
                                     var="entry" value="#{analiseBean.listaDeResultados}"
                                     filteredValue="#{analiseBean.resultadoFiltrado}"
                                     paginator="true"
                                     rows="10"
                                     paginatorPosition="bottom"
                                     paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                     rowsPerPageTemplate="5,10,15,25,50"
                                     emptyMessage="Nenhuma palavra encontrada para os critérios de busca."
                                     style="margin-top: 20px;"
                                     styleClass="ui-datatable-striped ui-datatable-gridlines">

                            <p:ajax event="filter" ignoreAutoUpdate="true" />
                            <p:ajax event="sort" ignoreAutoUpdate="true" />
                            <p:ajax event="page" ignoreAutoUpdate="true" />

                            <p:column headerText="Palavra" sortBy="#{entry.key}" filterBy="#{entry.key}" filterMatchMode="contains" filterStyle="width: 90%;">
                                <h:outputText value="#{entry.key}"/>
                            </p:column>

                            <p:column headerText="Ocorrências" sortBy="#{entry.value}" style="text-align: center; width: 150px;">
                                <h:outputText value="#{entry.value}"/>
                            </p:column>
                        </p:dataTable>
                    </p:panel>

                </h:form>
            </p:tab>

            <p:tab title="Histórico da Sessão" rendered="#{not empty historicoSessaoBean.historico}">

                <ui:repeat value="#{historicoSessaoBean.historico}" var="item">

                    <p:panel toggleable="true" collapsed="true" style="margin-bottom: 10px;">

                        <f:facet name="header">
                            <h:outputText value="Análise de '#{item.fraseOriginal.length() > 50 ? item.fraseOriginal.substring(0, 50).concat('...') : item.fraseOriginal}' | Palavras: #{item.contagemPalavrasDistintas} | Data: " />
                            <h:outputText value="#{item.dataAnalise}">
                                <f:convertDateTime pattern="dd/MM/yyyy HH:mm:ss" timeZone="America/Sao_Paulo" />
                            </h:outputText>
                        </f:facet>

                        <h:panelGrid columns="2" cellpadding="10">
                            <h:outputText value="Frase Completa:" style="font-weight:bold" />
                            <h:outputText value="#{item.fraseOriginal}" style="word-break: break-all;" />
                        </h:panelGrid>

                        <p:dataTable var="palavraEntry" value="#{item.resultadoAsList}" rows="5" paginator="true" paginatorPosition="bottom" style="margin-top:10px;">
                            <p:column headerText="Palavra">
                                <h:outputText value="#{palavraEntry.key}" />
                            </p:column>
                            <p:column headerText="Ocorrências" style="text-align: center; width: 120px;">
                                <h:outputText value="#{palavraEntry.value}" />
                            </p:column>
                        </p:dataTable>

                    </p:panel>

                </ui:repeat>
            </p:tab>

        </p:tabView>
    </div>
</h:body>
</html>